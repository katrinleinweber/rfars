<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Download raw data from the Fatality Analysis Reporting System (&lt;https://cdan.dot.gov/query&gt;)
    and prepare it for research.">
<title>Download and Analyze Fatal Crash Data • rfars</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Download and Analyze Fatal Crash Data">
<meta property="og:description" content="Download raw data from the Fatality Analysis Reporting System (&lt;https://cdan.dot.gov/query&gt;)
    and prepare it for research.">
<meta property="og:image" content="https://s87jackson.github.io/rfars/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">rfars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Crash_Sequences.html">Crash Sequences</a>
    <a class="dropdown-item" href="articles/Rural_roads.html">Rural Roads</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/s87jackson/rfars/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.svg" class="logo" alt=""><h1 id="rfars-">rfars <a class="anchor" aria-label="anchor" href="#rfars-"></a>
</h1>
</div>
<!-- badges: start -->
<!-- badges: end --><p>The goal of <code>rfars</code> is to simplify the process of analyzing FARS data. FARS stands for <a href="https://www.nhtsa.gov/research-data/fatality-analysis-reporting-system-fars" class="external-link">Fatality Analysis Reporting System</a>, the census of fatal crashes in the United States maintained by the <a href="https://www.nhtsa.gov/" class="external-link">National Highway Traffic Safety Administration</a>. The <a href="https://cdan.dot.gov/query" class="external-link">Fatality and Injury Reporting System Tool</a> allows users to generate queries, and can produce simple tables and graphs. This suffices for simple analysis, but often leaves researchers wanting more. Digging any deeper, however, involves a time-consuming process of downloading annual ZIP files and attempting to stitch them together - after first combing through the immense <a href="https://crashstats.nhtsa.dot.gov/Api/Public/ViewPublication/813254" class="external-link">data dictionary</a> to determine the required variables and table names. <code>rfars</code> allows users to download FARS data back to 2015 with just one line of code. The result is a full, rich dataset ready for mapping, modeling, and other downstream analysis. Helper functions are also provided to produce common counts and comparisons.</p>
<p>A companion package <code>rfarsplus</code> (currently in development) will provide exposure data and facilitate the calculation of various rates.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the latest version of <code>rfars</code> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"s87jackson/rfars"</span><span class="op">)</span></span></code></pre></div>
<p>Then load the required packages:</p>
</div>
<div class="section level2">
<h2 id="getting-and-using-fars-data">Getting and Using FARS Data<a class="anchor" aria-label="anchor" href="#getting-and-using-fars-data"></a>
</h2>
<p>Use the <code><a href="reference/get_fars.html">get_fars()</a></code> function to bring FARS data into the current environment. This is done by (a) downloading the data to a temporary directory, (b) downloading to a permanent directory, or (c) importing from a permanent directory. After data is downloaded to a permanent directory, the function will look there rather than downloading the data again. If a year of data is requested but not found, R will ask your permission to download the missing data.</p>
<p>Here we get three years of data for Virginia:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myFARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_fars.html">get_fars</a></span><span class="op">(</span>years <span class="op">=</span> <span class="fl">2018</span><span class="op">:</span><span class="fl">2020</span>, states <span class="op">=</span> <span class="st">"VA"</span><span class="op">)</span></span></code></pre></div>
<p>This returns a ‘FARS’ object: a list with five tibbles: <code>flat</code>, <code>multi_acc</code>, <code>multi_veh</code>, <code>multi_per</code>, and <code>events</code>.</p>
<p>The <code>flat</code> tibble contains all variables for which there is just one value per crash (“accident”), vehicle, or person (e.g., weather conditions, travel speed, age). Each row corresponds to a person involved in a crash. As there may be multiple people and/or vehicles involved in one crash, some variable-values are repeated within a crash or vehicle. Each crash is uniquely identified with <code>id</code>, which is a combination of <code>year</code> and <code>st_case</code>. Note that <code>st_case</code> is not unique across years, for example, <code>st_case</code> 510001 will appear in each year. The <code>id</code> variable attempts to avoid this issue.</p>
<p>The <code>multi_</code> tibbles contain those variables for which there may be a varying number of values for any entity (e.g., driver impairments, vehicle events, weather conditions at time of crash). Each tibble has the requisite data elements corresponding to the entity: <code>multi_acc</code> includes <code>st_case</code> and <code>year</code>, <code>multi_veh</code> adds <code>veh_no</code> (vehicle number), and <code>multi_per</code> adds <code>per_no</code> (person number).</p>
<p>The <code>events</code> tibble provides a sequence of numbered events for each vehicle in each crash.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">glimpse</span><span class="op">(</span><span class="va">myFARS</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ flat     : tibble [5,259 × 194] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ year         : num [1:5259] 2018 2018 2018 2018 2018 ...</span></span>
<span><span class="co">#&gt;   ..$ state        : chr [1:5259] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case      : num [1:5259] 510001 510001 510001 510002 510002 ...</span></span>
<span><span class="co">#&gt;   ..$ id           : num [1:5259] 2.02e+09 2.02e+09 2.02e+09 2.02e+09 2.02e+09 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no       : num [1:5259] 1 1 1 1 2 0 1 1 1 2 ...</span></span>
<span><span class="co">#&gt;   ..$ per_no       : num [1:5259] 1 2 3 1 1 1 1 1 2 1 ...</span></span>
<span><span class="co">#&gt;   ..$ county       : chr [1:5259] "RICHMOND (760)" "RICHMOND (760)" "RICHMOND (760)" "PITTSYLVANIA (143)" ...</span></span>
<span><span class="co">#&gt;   ..$ city         : chr [1:5259] "RICHMOND" "RICHMOND" "RICHMOND" "NOT APPLICABLE" ...</span></span>
<span><span class="co">#&gt;   ..$ lon          : num [1:5259] -77.4 -77.4 -77.4 -79.4 -79.4 ...</span></span>
<span><span class="co">#&gt;   ..$ lat          : num [1:5259] 37.6 37.6 37.6 36.7 36.7 ...</span></span>
<span><span class="co">#&gt;   ..$ ve_total     : num [1:5259] 1 1 1 2 2 1 1 2 2 2 ...</span></span>
<span><span class="co">#&gt;   ..$ ve_forms     : num [1:5259] 1 1 1 2 2 1 1 2 2 2 ...</span></span>
<span><span class="co">#&gt;   ..$ pvh_invl     : num [1:5259] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ peds         : num [1:5259] 0 0 0 0 0 1 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ persons      : num [1:5259] 3 3 3 2 2 1 1 3 3 3 ...</span></span>
<span><span class="co">#&gt;   ..$ permvit      : num [1:5259] 3 3 3 2 2 1 1 3 3 3 ...</span></span>
<span><span class="co">#&gt;   ..$ pernotmvit   : num [1:5259] 0 0 0 0 0 1 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ day          : num [1:5259] 1 1 1 3 3 3 3 2 2 2 ...</span></span>
<span><span class="co">#&gt;   ..$ month        : chr [1:5259] "January" "January" "January" "January" ...</span></span>
<span><span class="co">#&gt;   ..$ day_week     : chr [1:5259] "Monday" "Monday" "Monday" "Wednesday" ...</span></span>
<span><span class="co">#&gt;   ..$ hour         : num [1:5259] 16 16 16 7 7 20 20 12 12 12 ...</span></span>
<span><span class="co">#&gt;   ..$ minute       : num [1:5259] 15 15 15 30 30 34 34 10 10 10 ...</span></span>
<span><span class="co">#&gt;   ..$ nhs          : chr [1:5259] "This section IS NOT on the NHS" "This section IS NOT on the NHS" "This section IS NOT on the NHS" "This section IS NOT on the NHS" ...</span></span>
<span><span class="co">#&gt;   ..$ route        : chr [1:5259] "Local Street - Municipality" "Local Street - Municipality" "Local Street - Municipality" "State Highway" ...</span></span>
<span><span class="co">#&gt;   ..$ tway_id      : chr [1:5259] "VA-127" "VA-127" "VA-127" "SR-41 FRANKLIN TRPK" ...</span></span>
<span><span class="co">#&gt;   ..$ tway_id2     : chr [1:5259] NA NA NA "GOLF CLUB RD" ...</span></span>
<span><span class="co">#&gt;   ..$ rur_urb      : chr [1:5259] "Urban" "Urban" "Urban" "Rural" ...</span></span>
<span><span class="co">#&gt;   ..$ func_sys     : chr [1:5259] "Major Collector" "Major Collector" "Major Collector" "Minor Arterial" ...</span></span>
<span><span class="co">#&gt;   ..$ rd_owner     : chr [1:5259] "City or Municipal Highway Agency" "City or Municipal Highway Agency" "City or Municipal Highway Agency" "State Highway Agency" ...</span></span>
<span><span class="co">#&gt;   ..$ milept       : chr [1:5259] "11" "11" "11" "35" ...</span></span>
<span><span class="co">#&gt;   ..$ sp_jur       : chr [1:5259] "No Special Jurisdiction" "No Special Jurisdiction" "No Special Jurisdiction" "No Special Jurisdiction" ...</span></span>
<span><span class="co">#&gt;   ..$ harm_ev      : chr [1:5259] "Tree (Standing Only)" "Tree (Standing Only)" "Tree (Standing Only)" "Motor Vehicle In-Transport" ...</span></span>
<span><span class="co">#&gt;   ..$ man_coll     : chr [1:5259] "Not a Collision with Motor Vehicle In-Transport" "Not a Collision with Motor Vehicle In-Transport" "Not a Collision with Motor Vehicle In-Transport" "Front-to-Front" ...</span></span>
<span><span class="co">#&gt;   ..$ reljct1      : chr [1:5259] "No" "No" "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ reljct2      : chr [1:5259] "Non-Junction" "Non-Junction" "Non-Junction" "Intersection-Related" ...</span></span>
<span><span class="co">#&gt;   ..$ typ_int      : chr [1:5259] "Not an Intersection" "Not an Intersection" "Not an Intersection" "T-Intersection" ...</span></span>
<span><span class="co">#&gt;   ..$ wrk_zone     : chr [1:5259] "None" "None" "None" "None" ...</span></span>
<span><span class="co">#&gt;   ..$ rel_road     : chr [1:5259] "On Roadside" "On Roadside" "On Roadside" "On Roadway" ...</span></span>
<span><span class="co">#&gt;   ..$ lgt_cond     : chr [1:5259] "Daylight" "Daylight" "Daylight" "Daylight" ...</span></span>
<span><span class="co">#&gt;   ..$ sch_bus      : chr [1:5259] "No" "No" "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ rail         : chr [1:5259] "Not Applicable" "Not Applicable" "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ not_hour     : num [1:5259] 99 99 99 99 99 99 99 99 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ not_min      : num [1:5259] 99 99 99 99 99 99 99 99 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ arr_hour     : num [1:5259] 99 99 99 99 99 99 99 99 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ arr_min      : num [1:5259] 99 99 99 99 99 99 99 99 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ hosp_hr      : num [1:5259] 99 99 99 99 99 88 88 99 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ hosp_mn      : num [1:5259] 99 99 99 99 99 88 88 99 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ fatals       : num [1:5259] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ drunk_dr     : num [1:5259] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ str_veh      : num [1:5259] 0 0 0 0 0 1 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ age          : chr [1:5259] "23 Years" "22 Years" "19 Years" "29 Years" ...</span></span>
<span><span class="co">#&gt;   ..$ sex          : chr [1:5259] "Male" "Male" "Female" "Male" ...</span></span>
<span><span class="co">#&gt;   ..$ per_typ      : chr [1:5259] "Driver of a Motor Vehicle In-Transport" "Passenger of a Motor Vehicle In-Transport" "Passenger of a Motor Vehicle In-Transport" "Driver of a Motor Vehicle In-Transport" ...</span></span>
<span><span class="co">#&gt;   ..$ inj_sev      : chr [1:5259] "Suspected Minor Injury (B)" "Suspected Serious Injury (A)" "Fatal Injury (K)" "Suspected Serious Injury (A)" ...</span></span>
<span><span class="co">#&gt;   ..$ seat_pos     : chr [1:5259] "Front Seat, Left Side" "Second Seat, Left Side" "Front Seat, Right Side" "Front Seat, Left Side" ...</span></span>
<span><span class="co">#&gt;   ..$ rest_use     : chr [1:5259] "None Used / Not Applicable" "None Used / Not Applicable" "None Used / Not Applicable" "Shoulder and Lap Belt Used" ...</span></span>
<span><span class="co">#&gt;   ..$ rest_mis     : chr [1:5259] "No" "No" "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ air_bag      : chr [1:5259] "Deployed- Front" "Not Deployed" "Not Deployed" "Deployed- Front" ...</span></span>
<span><span class="co">#&gt;   ..$ ejection     : chr [1:5259] "Not Ejected" "Not Ejected" "Not Ejected" "Not Ejected" ...</span></span>
<span><span class="co">#&gt;   ..$ ej_path      : chr [1:5259] "Ejection Path Not Applicable" "Ejection Path Not Applicable" "Ejection Path Not Applicable" "Ejection Path Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ extricat     : chr [1:5259] "Not Extricated or Not Applicable" "Not Extricated or Not Applicable" "Not Extricated or Not Applicable" "Not Extricated or Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ drinking     : chr [1:5259] "No (Alcohol Not Involved)" "Not Reported" "Not Reported" "No (Alcohol Not Involved)" ...</span></span>
<span><span class="co">#&gt;   ..$ alc_det      : chr [1:5259] "Not Reported" "Not Reported" "Not Reported" "Not Reported" ...</span></span>
<span><span class="co">#&gt;   ..$ alc_status   : chr [1:5259] "Test Not Given" "Test Not Given" "Test Not Given" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ atst_typ     : chr [1:5259] "Test Not Given" "Test Not Given" "Test Not Given" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ alc_res      : chr [1:5259] "Test Not Given" "Test Not Given" "Test Not Given" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ drugs        : chr [1:5259] "Reported as Unknown" "Not Reported" "Not Reported" "No (drugs not involved)" ...</span></span>
<span><span class="co">#&gt;   ..$ drug_det     : chr [1:5259] "Not Reported" "Not Reported" "Not Reported" "Not Reported" ...</span></span>
<span><span class="co">#&gt;   ..$ dstatus      : chr [1:5259] "Test Not Given" "Test Not Given" "Test Not Given" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ hospital     : chr [1:5259] "EMS Unknown Mode" "EMS Unknown Mode" "Not Transported" "EMS Unknown Mode" ...</span></span>
<span><span class="co">#&gt;   ..$ doa          : chr [1:5259] "Not Applicable" "Not Applicable" "Died at Scene" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ death_da     : chr [1:5259] "Not Applicable (Non-Fatal)" "Not Applicable (Non-Fatal)" "1" "Not Applicable (Non-Fatal)" ...</span></span>
<span><span class="co">#&gt;   ..$ death_mo     : chr [1:5259] "Not Applicable (Non-Fatal)" "Not Applicable (Non-Fatal)" "January" "Not Applicable (Non-Fatal)" ...</span></span>
<span><span class="co">#&gt;   ..$ death_yr     : chr [1:5259] "Not Applicable (Non-fatal)" "Not Applicable (Non-fatal)" "2018" "Not Applicable (Non-fatal)" ...</span></span>
<span><span class="co">#&gt;   ..$ death_hr     : num [1:5259] 88 88 16 88 8 20 88 12 88 88 ...</span></span>
<span><span class="co">#&gt;   ..$ death_mn     : num [1:5259] 88 88 20 88 45 40 88 39 88 88 ...</span></span>
<span><span class="co">#&gt;   ..$ death_tm     : chr [1:5259] "Not Applicable (Non-fatal)" "Not Applicable (Non-fatal)" "1620" "Not Applicable (Non-fatal)" ...</span></span>
<span><span class="co">#&gt;   ..$ lag_hrs      : num [1:5259] 999 999 0 999 1 0 999 0 999 999 ...</span></span>
<span><span class="co">#&gt;   ..$ lag_mins     : num [1:5259] 99 99 5 99 15 6 99 29 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ work_inj     : chr [1:5259] "Not Applicable (not a fatality)" "Not Applicable (not a fatality)" "No" "Not Applicable (not a fatality)" ...</span></span>
<span><span class="co">#&gt;   ..$ hispanic     : chr [1:5259] "Not A Fatality (not Applicable)" "Not A Fatality (not Applicable)" "Non-Hispanic" "Not A Fatality (not Applicable)" ...</span></span>
<span><span class="co">#&gt;   ..$ location     : chr [1:5259] "Occupant of a Motor Vehicle" "Occupant of a Motor Vehicle" "Occupant of a Motor Vehicle" "Occupant of a Motor Vehicle" ...</span></span>
<span><span class="co">#&gt;   ..$ numoccs      : chr [1:5259] "03" "03" "03" "01" ...</span></span>
<span><span class="co">#&gt;   ..$ unittype     : chr [1:5259] "Motor Vehicle In-Transport (Inside or Outside the Trafficway)" "Motor Vehicle In-Transport (Inside or Outside the Trafficway)" "Motor Vehicle In-Transport (Inside or Outside the Trafficway)" "Motor Vehicle In-Transport (Inside or Outside the Trafficway)" ...</span></span>
<span><span class="co">#&gt;   ..$ hit_run      : chr [1:5259] "No" "No" "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ reg_stat     : chr [1:5259] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ owner        : chr [1:5259] "Driver (in this crash) was  Registered Owner" "Driver (in this crash) was  Registered Owner" "Driver (in this crash) was  Registered Owner" "Driver (in this crash) was  Registered Owner" ...</span></span>
<span><span class="co">#&gt;   ..$ make         : chr [1:5259] "Honda" "Honda" "Honda" "Honda" ...</span></span>
<span><span class="co">#&gt;   ..$ model        : num [1:5259] 32 32 32 32 2 NA 401 403 403 881 ...</span></span>
<span><span class="co">#&gt;   ..$ mak_mod      : chr [1:5259] "Honda Accord (Note: For Crosstour model years 2010 and 2011 only. For Crosstour model years 2012-2015, see vehi"| __truncated__ "Honda Accord (Note: For Crosstour model years 2010 and 2011 only. For Crosstour model years 2012-2015, see vehi"| __truncated__ "Honda Accord (Note: For Crosstour model years 2010 and 2011 only. For Crosstour model years 2012-2015, see vehi"| __truncated__ "Honda Accord (Note: For Crosstour model years 2010 and 2011 only. For Crosstour model years 2012-2015, see vehi"| __truncated__ ...</span></span>
<span><span class="co">#&gt;   ..$ body_typ     : chr [1:5259] "4-door sedan, hardtop" "4-door sedan, hardtop" "4-door sedan, hardtop" "4-door sedan, hardtop" ...</span></span>
<span><span class="co">#&gt;   ..$ mod_year     : chr [1:5259] "2005" "2005" "2005" "2003" ...</span></span>
<span><span class="co">#&gt;   ..$ vin          : chr [1:5259] "1HGCM66535A0" "1HGCM66535A0" "1HGCM66535A0" "1HGCM56333A0" ...</span></span>
<span><span class="co">#&gt;   ..$ tow_veh      : chr [1:5259] "No Trailing Units" "No Trailing Units" "No Trailing Units" "No Trailing Units" ...</span></span>
<span><span class="co">#&gt;   ..$ j_knife      : chr [1:5259] "Not an Articulated Vehicle" "Not an Articulated Vehicle" "Not an Articulated Vehicle" "Not an Articulated Vehicle" ...</span></span>
<span><span class="co">#&gt;   ..$ mcarr_i1     : chr [1:5259] "Not Applicable" "Not Applicable" "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ mcarr_i2     : chr [1:5259] "Not Applicable" "Not Applicable" "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ mcarr_id     : chr [1:5259] "Not Applicable" "Not Applicable" "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ v_config     : chr [1:5259] "Not Applicable" "Not Applicable" "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ multi_acc:'data.frame':   4777 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ state  : chr [1:4777] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case: num [1:4777] 510001 510002 510003 510004 510005 ...</span></span>
<span><span class="co">#&gt;   ..$ name   : chr [1:4777] "weather" "weather" "weather" "weather" ...</span></span>
<span><span class="co">#&gt;   ..$ value  : chr [1:4777] "Not Reported" "Not Reported" "Not Reported" "Not Reported" ...</span></span>
<span><span class="co">#&gt;   ..$ year   : num [1:4777] 2018 2018 2018 2018 2018 ...</span></span>
<span><span class="co">#&gt;  $ multi_veh:'data.frame':   47959 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;   ..$ state  : chr [1:47959] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case: num [1:47959] 510001 510002 510002 510003 510004 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no : num [1:47959] 1 1 2 1 1 2 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ name   : chr [1:47959] "vehiclesf" "vehiclesf" "vehiclesf" "vehiclesf" ...</span></span>
<span><span class="co">#&gt;   ..$ value  : chr [1:47959] "None" "None" "None" "None" ...</span></span>
<span><span class="co">#&gt;   ..$ year   : num [1:47959] 2018 2018 2018 2018 2018 ...</span></span>
<span><span class="co">#&gt;  $ multi_per:'data.frame':   31896 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;   ..$ state  : chr [1:31896] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case: num [1:31896] 510001 510001 510001 510002 510002 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no : num [1:31896] 1 1 1 1 2 0 1 1 1 2 ...</span></span>
<span><span class="co">#&gt;   ..$ per_no : num [1:31896] 1 2 3 1 1 1 1 1 2 1 ...</span></span>
<span><span class="co">#&gt;   ..$ name   : chr [1:31896] "race" "race" "race" "race" ...</span></span>
<span><span class="co">#&gt;   ..$ value  : chr [1:31896] "Not a Fatality (not Applicable)" "Not a Fatality (not Applicable)" "Black" "Not a Fatality (not Applicable)" ...</span></span>
<span><span class="co">#&gt;   ..$ year   : num [1:31896] 2018 2018 2018 2018 2018 ...</span></span>
<span><span class="co">#&gt;  $ events   :'data.frame':   8410 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;   ..$ state    : chr [1:8410] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case  : num [1:8410] 510001 510001 510002 510002 510002 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no   : num [1:8410] 1 1 1 1 2 1 1 2 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ veventnum: num [1:8410] 1 2 1 2 1 1 1 1 1 2 ...</span></span>
<span><span class="co">#&gt;   ..$ soe      : chr [1:8410] "Ran Off Roadway - Right" "Tree (Standing Only)" "Cross Centerline" "Motor Vehicle In-Transport" ...</span></span>
<span><span class="co">#&gt;   ..$ aoi      : chr [1:8410] "Non-Harmful Event" "1 Clock Point" "Non-Harmful Event" "12 Clock Point" ...</span></span>
<span><span class="co">#&gt;   ..$ year     : num [1:8410] 2018 2018 2018 2018 2018 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "list" "FARS"</span></span></code></pre></div>
<p>You can review the list of variables to help guide your analysis with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">fars_varnames</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="counts">Counts<a class="anchor" aria-label="anchor" href="#counts"></a>
</h2>
<p>A first step in many transportation safety analyses involves counting the number of relevant crashes, fatalities, or people involved. <code><a href="reference/counts.html">counts()</a></code> lets users specify <em>what</em> to count, <em>where</em> to count them (rural/urban and/or in specified states), <em>who</em> to include, which <em>years</em> to include and an aggregation <em>interval</em> (annually or monthly), and factors <em>involved</em> in the crash. It returns a simple tibble that can be easily piped into <code>ggplot()</code> to quickly visualize counts.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>,</span>
<span>  interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Fatal Crashes in Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>  interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Fatalities in Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"rural"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Rural Fatalities in Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"rural"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>       involved <span class="op">=</span> <span class="st">"speeding"</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Speeding-Related Fatalities in Rural Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
<p>We can combine two <code><a href="reference/counts.html">counts()</a></code> results to make a comparison. Here we compare the number of speeding-related fatalities in rural and urban Virginia:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"rural"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>       involved <span class="op">=</span> <span class="st">"speeding"</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"Rural"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"urban"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>       involved <span class="op">=</span> <span class="st">"speeding"</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"Urban"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">where</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Speeding-Related Fatalities in Virginia"</span>, fill<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="mapping">Mapping<a class="anchor" aria-label="anchor" href="#mapping"></a>
</h2>
<p>We can take advantage of having access to the full data with maps. Here we map pedestrian and bicyclist fatalities in Virginia:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>, </span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>, </span>
<span>  involved <span class="op">=</span> <span class="st">"pedbike"</span>, </span>
<span>  filterOnly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addHeatmap</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Heatmap"</span>, radius<span class="op">=</span><span class="fl">10</span>, blur<span class="op">=</span><span class="fl">20</span>, minOpacity <span class="op">=</span> <span class="fl">.01</span>, max <span class="op">=</span> <span class="fl">.2</span>, cellSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span></span>
<span>    radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fillOpacity <span class="op">=</span> <span class="fl">0.7</span>, group <span class="op">=</span> <span class="st">"Crash Locations"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
<p>Drug-related crashes:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>, </span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>, </span>
<span>  involved <span class="op">=</span> <span class="st">"drugs"</span>, </span>
<span>  filterOnly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addHeatmap</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Heatmap"</span>, radius<span class="op">=</span><span class="fl">10</span>, blur<span class="op">=</span><span class="fl">20</span>, minOpacity <span class="op">=</span> <span class="fl">.01</span>, max <span class="op">=</span> <span class="fl">.2</span>, cellSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span></span>
<span>    radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fillOpacity <span class="op">=</span> <span class="fl">0.7</span>, group <span class="op">=</span> <span class="st">"Crash Locations"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<p>Young drivers:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>, </span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>, </span>
<span>  involved <span class="op">=</span> <span class="st">"young driver"</span>, </span>
<span>  filterOnly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addHeatmap</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Heatmap"</span>, radius<span class="op">=</span><span class="fl">10</span>, blur<span class="op">=</span><span class="fl">20</span>, minOpacity <span class="op">=</span> <span class="fl">.01</span>, max <span class="op">=</span> <span class="fl">.2</span>, cellSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span></span>
<span>    radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fillOpacity <span class="op">=</span> <span class="fl">0.7</span>, group <span class="op">=</span> <span class="st">"Crash Locations"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Note: Young drivers are defined as those between the ages of 15 and 20.</span></span>
<span><span class="co">#&gt; Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="modeling">Modeling<a class="anchor" aria-label="anchor" href="#modeling"></a>
</h2>
<p>Having access to the full dataset also allows us to develop statistical models. Here we fit a simple model of injury severity as a function of age and restraint use. The results indicate that injury severity increases with age, and when seat belts are not used properly.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># table(myFARS$flat$inj_sev)</span></span>
<span><span class="co"># table(myFARS$flat$rest_use, useNA = "ifany")</span></span>
<span><span class="co"># table(myFARS$flat$per_typ, useNA = "ifany")</span></span>
<span></span>
<span><span class="va">model_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">myFARS</span><span class="op">$</span><span class="va">flat</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lap Belt Only Used"</span>,</span>
<span>                         <span class="st">"Shoulder Belt Only Used"</span>,</span>
<span>                         <span class="st">"None Used / Not Applicable"</span>,</span>
<span>                         <span class="st">"None Used/Not Applicable"</span>,</span>
<span>                         <span class="st">"Shoulder and Lap Belt Used"</span><span class="op">)</span>,</span>
<span>         <span class="va">per_typ</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Driver of a Motor Vehicle In-Transport"</span>,</span>
<span>                        <span class="st">"Passenger of a Motor Vehicle In-Transport"</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    rest_use <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lap Belt Only Used"</span>, <span class="st">"Shoulder Belt Only Used"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Partial"</span>,</span>
<span>      <span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"None Used / Not Applicable"</span>, <span class="st">"None Used/Not Applicable"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"None"</span>,</span>
<span>      <span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Shoulder and Lap Belt Used"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Full"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Unknown"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"Full"</span><span class="op">)</span>,</span>
<span>    kabco <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">inj_sev</span> <span class="op">==</span> <span class="st">"Fatal Injury (K)"</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Suspected Serious Injury (A)"</span>, </span>
<span>                     <span class="st">"Suspected Serious Injury(A)"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Suspected Minor Injury (B)"</span>, </span>
<span>                     <span class="st">"Suspected Minor Injury(B)"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op">==</span> <span class="st">"Possible Injury (C)"</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op">==</span> <span class="st">"No Apparent Injury (O)"</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    age_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D+"</span>,<span class="st">""</span>, <span class="va">age</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">kabco</span> <span class="op">~</span> <span class="va">age_n</span> <span class="op">+</span> <span class="va">rest_use</span>, data <span class="op">=</span> <span class="va">model_data</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">stargazer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html" class="external-link">stargazer</a></span><span class="op">(</span><span class="va">my_model</span>, type <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
<table style="text-align:center" class="table">
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr>
<tr>
<td style="text-align:left"></td>
<td><em>Dependent variable:</em></td>
</tr>
<tr>
<td></td>
<td colspan="1" style="border-bottom: 1px solid black"></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td>kabco</td>
</tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr>
<tr>
<td style="text-align:left">age_n</td>
<td>0.009<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td>(0.001)</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td></td>
</tr>
<tr>
<td style="text-align:left">rest_useNone</td>
<td>1.474<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td>(0.042)</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td></td>
</tr>
<tr>
<td style="text-align:left">rest_usePartial</td>
<td>0.520<sup>**</sup>
</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td>(0.222)</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td></td>
</tr>
<tr>
<td style="text-align:left">Constant</td>
<td>1.702<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td>(0.053)</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td></td>
</tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr>
<tr>
<td style="text-align:left">Observations</td>
<td>4,301</td>
</tr>
<tr>
<td style="text-align:left">R<sup>2</sup>
</td>
<td>0.224</td>
</tr>
<tr>
<td style="text-align:left">Adjusted R<sup>2</sup>
</td>
<td>0.224</td>
</tr>
<tr>
<td style="text-align:left">Residual Std. Error</td>
<td>1.338 (df = 4297)</td>
</tr>
<tr>
<td style="text-align:left">F Statistic</td>
<td>414.442<sup>***</sup> (df = 3; 4297)</td>
</tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr>
<tr>
<td style="text-align:left"><em>Note:</em></td>
<td style="text-align:right">
<sup><em></em></sup>p&lt;0.1; <sup><strong></strong></sup>p&lt;0.05; <sup></sup>p&lt;0.01</td>
</tr>
</table>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  age_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>,</span>
<span>  rest_use <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Full"</span>, <span class="st">"Partial"</span>, <span class="st">"None"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Full"</span>, <span class="st">"Partial"</span>, <span class="st">"None"</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">new_data</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">my_model</span>, newdata <span class="op">=</span> <span class="va">new_data</span><span class="op">)</span>,</span>
<span>         age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">age_n</span>, <span class="st">" yrs"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">rest_use</span>, y<span class="op">=</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"O"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"K"</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.grid.major.y <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span>, title <span class="op">=</span> <span class="st">"Predicted Injury Severity by Age and Restraint Use"</span>,</span>
<span>         caption <span class="op">=</span> <span class="st">"Full = correctly used seatbelt, partial = partially correctly used, none = no seatbelt."</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/s87jackson/rfars/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/s87jackson/rfars/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>CC0</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rfars</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Steve Jackson <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://app.travis-ci.com/github/s87jackson/rfars" class="external-link"><img src="https://travis-ci.com/s87jackson/rfars.svg?branch=master" alt="Travis build status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
