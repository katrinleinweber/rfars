<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Download raw data from the Fatality Analysis Reporting System 
    and prepare it for research.">
<title>Download and Analyze Fatal Crash Data • rfars</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Download and Analyze Fatal Crash Data">
<meta property="og:description" content="Download raw data from the Fatality Analysis Reporting System 
    and prepare it for research.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">rfars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Crash_Sequences.html">Crash Sequences</a>
    <a class="dropdown-item" href="articles/Rural_roads.html">Rural Roads</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/s87jackson/rfars/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rfars">rfars<a class="anchor" aria-label="anchor" href="#rfars"></a>
</h1></div>
<!-- badges: start -->
<p>The goal of <code>rfars</code> is to simplify the process of analyzing FARS data. FARS stands for <a href="https://www.nhtsa.gov/research-data/fatality-analysis-reporting-system-fars" class="external-link">Fatality Analysis Reporting System</a>, the census of fatal crashes in the United States maintained by the <a href="https://www.nhtsa.gov/" class="external-link">National Highway Traffic Safety Administration</a>. The <a href="https://cdan.dot.gov/query" class="external-link">Fatality and Injury Reporting System Tool</a> allows users to generate queries, and can produce simple tables and graphs. This suffices for simple analysis, but often leaves researchers wanting more. Digging any deeper, however, involves a time-consuming process of downloading annual ZIP files and attempting to stitch them together - after first combing through the immense <a href="https://crashstats.nhtsa.dot.gov/Api/Public/ViewPublication/813254" class="external-link">data dictionary</a> to determine the required variables and table names. <code>rfars</code> allows users to download FARS data back to 2016 with just two lines of code. The result is a full, rich dataset ready for mapping, modeling, and other downstream analysis. Helper functions are also provided to produce common counts and comparisons.</p>
<p>A companion package <code>rfarsplus</code> (currently in development) will provide exposure data and facilitate the calculation of various rates.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the latest version of <code>rfars</code> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"s87jackson/rfars"</span><span class="op">)</span></span></code></pre></div>
<p>Then load the required packages:</p>
</div>
<div class="section level2">
<h2 id="getting-and-using-fars-data">Getting and Using FARS Data<a class="anchor" aria-label="anchor" href="#getting-and-using-fars-data"></a>
</h2>
<p>Use the <code><a href="reference/get_fars.html">get_fars()</a></code> function to download the ZIP files from NHTSA and save the prepared files to your hard drive. This only has to be run once and defaults to saving everything in the current working directory. Below we import all available data for the state of Virginia. Note that <code><a href="reference/get_fars.html">get_fars()</a></code> requires your permission to download the ZIP files and store prepared CSVs locally, unless you set <code>proceed=TRUE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_fars.html">get_fars</a></span><span class="op">(</span>states<span class="op">=</span><span class="st">"VA"</span>, proceed<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Raw data files have been saved to C:/Users/s87ja/Dropbox/Work/toXcel/FARS/rfars/FARS data/raw/</span></span>
<span><span class="co">#&gt; Preparing the 2015 files...................</span></span>
<span><span class="co">#&gt; Preparing the 2016 files...................</span></span>
<span><span class="co">#&gt; Preparing the 2017 files...................</span></span>
<span><span class="co">#&gt; Preparing the 2018 files...................</span></span>
<span><span class="co">#&gt; Preparing the 2019 files...................</span></span>
<span><span class="co">#&gt; Preparing the 2020 files...................</span></span>
<span><span class="co">#&gt; Prepared data files have been saved to C:/Users/s87ja/Dropbox/Work/toXcel/FARS/rfars/FARS data/prepared/</span></span></code></pre></div>
<p>The <code><a href="reference/use_fars.html">use_fars()</a></code> function looks in a specified directory (the working directory by default) for certain CSV files and compiles them into a list with five tibbles: <code>flat</code>, <code>multi_acc</code>, <code>multi_veh</code>, <code>multi_per</code>, and <code>events</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myFARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/use_fars.html">use_fars</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p>The <code>flat</code> tibble contains all variables for which there is just one value per person, vehicle, or crash (e.g., age, travel speed, lighting). Each row corresponds to a person involved in a crash. As there may be multiple people and/or vehicles involved in one crash, some variable-values are repeated within a crash or vehicle. Each crash is uniquely identified with <code>id</code>, which is a combination of <code>year</code> and <code>st_case</code>. Note that <code>st_case</code> is not unique across years, for example, <code>st_case</code> 510001 will appear in each year. The <code>id</code> variable attempts to avoid this issue.</p>
<p>The <code>multi_</code> tibbles contain those variables for which there may be a varying number of values for any entity (e.g., driver impairments, vehicle events, weather conditions at time of crash). Each tibble has the requisite data elements corresponding to the entity: <code>multi_acc</code> includes <code>st_case</code> and <code>year</code>, <code>multi_veh</code> adds <code>veh_no</code> (vehicle number), and <code>multi_per</code> adds <code>per_no</code> (person number).</p>
<p>The <code>events</code> tibble provides a sequence of numbered events for each vehicle in each crash.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">myFARS</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ flat     : tibble [10,150 × 196] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ year         : num [1:10150] 2015 2015 2015 2015 2015 ...</span></span>
<span><span class="co">#&gt;   ..$ state        : chr [1:10150] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case      : num [1:10150] 510001 510002 510002 510003 510004 ...</span></span>
<span><span class="co">#&gt;   ..$ id           : num [1:10150] 2.02e+09 2.02e+09 2.02e+09 2.02e+09 2.02e+09 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no       : num [1:10150] 1 0 1 1 1 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ per_no       : num [1:10150] 1 1 1 1 1 1 2 1 1 2 ...</span></span>
<span><span class="co">#&gt;   ..$ county       : chr [1:10150] "143" "840" "840" "185" ...</span></span>
<span><span class="co">#&gt;   ..$ city         : chr [1:10150] "0" "2640" "2640" "0" ...</span></span>
<span><span class="co">#&gt;   ..$ lon          : num [1:10150] -79.2 -78.2 -78.2 -81.8 -79.3 ...</span></span>
<span><span class="co">#&gt;   ..$ lat          : num [1:10150] 37 39.2 39.2 37 37.1 ...</span></span>
<span><span class="co">#&gt;   ..$ ve_total     : num [1:10150] 1 1 1 1 2 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ ve_forms     : num [1:10150] 1 1 1 1 2 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ pvh_invl     : num [1:10150] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ peds         : num [1:10150] 0 1 1 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ persons      : num [1:10150] 1 1 1 1 3 3 3 1 2 2 ...</span></span>
<span><span class="co">#&gt;   ..$ permvit      : num [1:10150] 1 1 1 1 3 3 3 1 2 2 ...</span></span>
<span><span class="co">#&gt;   ..$ pernotmvit   : num [1:10150] 0 1 1 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ day          : num [1:10150] 1 2 2 2 4 4 4 3 6 6 ...</span></span>
<span><span class="co">#&gt;   ..$ month        : chr [1:10150] "January" "January" "January" "January" ...</span></span>
<span><span class="co">#&gt;   ..$ day_week     : chr [1:10150] "Thursday" "Friday" "Friday" "Friday" ...</span></span>
<span><span class="co">#&gt;   ..$ hour         : num [1:10150] 15 18 18 13 15 15 15 7 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ minute       : num [1:10150] 30 59 59 55 15 15 15 58 19 19 ...</span></span>
<span><span class="co">#&gt;   ..$ nhs          : chr [1:10150] "This section IS NOT on the NHS" "This section IS NOT on the NHS" "This section IS NOT on the NHS" "This section IS NOT on the NHS" ...</span></span>
<span><span class="co">#&gt;   ..$ route        : chr [1:10150] "County Road" "Unknown" "Unknown" "County Road" ...</span></span>
<span><span class="co">#&gt;   ..$ tway_id      : chr [1:10150] "CR-668" "HANDLEY BLVD" "HANDLEY BLVD" "CR-609" ...</span></span>
<span><span class="co">#&gt;   ..$ tway_id2     : chr [1:10150] NA "S STEWARD ST" "S STEWARD ST" NA ...</span></span>
<span><span class="co">#&gt;   ..$ rur_urb      : chr [1:10150] "Rural" "Urban" "Urban" "Rural" ...</span></span>
<span><span class="co">#&gt;   ..$ func_sys     : chr [1:10150] "Major Collector" "Local" "Local" "Major Collector" ...</span></span>
<span><span class="co">#&gt;   ..$ rd_owner     : chr [1:10150] "State Highway Agency" "Not Reported" "Not Reported" "State Highway Agency" ...</span></span>
<span><span class="co">#&gt;   ..$ milept       : chr [1:10150] "68" "None" "None" "87" ...</span></span>
<span><span class="co">#&gt;   ..$ sp_jur       : chr [1:10150] "No Special Jurisdiction" "No Special Jurisdiction" "No Special Jurisdiction" "No Special Jurisdiction" ...</span></span>
<span><span class="co">#&gt;   ..$ harm_ev      : chr [1:10150] "Other Post, Other Pole or Other Supports" "Pedalcyclist" "Pedalcyclist" "Rollover/Overturn" ...</span></span>
<span><span class="co">#&gt;   ..$ man_coll     : chr [1:10150] "Not a Collision with Motor Vehicle In-Transport" "Not a Collision with Motor Vehicle In-Transport" "Not a Collision with Motor Vehicle In-Transport" "Not a Collision with Motor Vehicle In-Transport" ...</span></span>
<span><span class="co">#&gt;   ..$ reljct1      : chr [1:10150] "No" "No" "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ reljct2      : chr [1:10150] "Non-Junction" "Intersection" "Intersection" "Non-Junction" ...</span></span>
<span><span class="co">#&gt;   ..$ typ_int      : chr [1:10150] "Not an Intersection" "T-Intersection" "T-Intersection" "Not an Intersection" ...</span></span>
<span><span class="co">#&gt;   ..$ wrk_zone     : chr [1:10150] "None" "None" "None" "None" ...</span></span>
<span><span class="co">#&gt;   ..$ rel_road     : chr [1:10150] "On Roadside" "On Roadway" "On Roadway" "Outside Trafficway" ...</span></span>
<span><span class="co">#&gt;   ..$ lgt_cond     : chr [1:10150] "Daylight" "Dark - Lighted" "Dark - Lighted" "Daylight" ...</span></span>
<span><span class="co">#&gt;   ..$ sch_bus      : chr [1:10150] "No" "No" "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ rail         : chr [1:10150] "Not Applicable" "Not Applicable" "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ not_hour     : num [1:10150] 99 19 19 13 99 99 99 99 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ not_min      : num [1:10150] 99 0 0 59 99 99 99 99 25 25 ...</span></span>
<span><span class="co">#&gt;   ..$ arr_hour     : num [1:10150] 99 19 19 14 99 99 99 99 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ arr_min      : num [1:10150] 99 5 5 8 99 99 99 99 30 30 ...</span></span>
<span><span class="co">#&gt;   ..$ hosp_hr      : num [1:10150] 99 19 19 14 99 99 99 88 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ hosp_mn      : num [1:10150] 99 20 20 36 99 99 99 88 42 42 ...</span></span>
<span><span class="co">#&gt;   ..$ fatals       : num [1:10150] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ drunk_dr     : num [1:10150] 1 0 0 0 1 1 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ str_veh      : num [1:10150] 0 1 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ age          : chr [1:10150] "70 Years" "59 Years" "68 Years" "62 Years" ...</span></span>
<span><span class="co">#&gt;   ..$ sex          : chr [1:10150] "Male" "Female" "Female" "Female" ...</span></span>
<span><span class="co">#&gt;   ..$ per_typ      : chr [1:10150] "Driver of a Motor Vehicle In-Transport" "Bicyclist" "Driver of a Motor Vehicle In-Transport" "Driver of a Motor Vehicle In-Transport" ...</span></span>
<span><span class="co">#&gt;   ..$ inj_sev      : chr [1:10150] "Fatal Injury (K)" "Fatal Injury (K)" "No Apparent Injury (O)" "Fatal Injury (K)" ...</span></span>
<span><span class="co">#&gt;   ..$ seat_pos     : chr [1:10150] "Front Seat, Left Side" "Not a Motor Vehicle Occupant" "Front Seat, Left Side" "Front Seat, Left Side" ...</span></span>
<span><span class="co">#&gt;   ..$ rest_use     : chr [1:10150] "None Used" "Not a Motor Vehicle Occupant" "Shoulder and Lap Belt Used" "Shoulder and Lap Belt Used" ...</span></span>
<span><span class="co">#&gt;   ..$ rest_mis     : chr [1:10150] "No" "Not a Motor Vehicle Occupant" "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ air_bag      : chr [1:10150] "Deployed- Front" "Not a Motor Vehicle Occupant" "Not Deployed" "Not Deployed" ...</span></span>
<span><span class="co">#&gt;   ..$ ejection     : chr [1:10150] "Not Ejected" "Not Applicable" "Not Ejected" "Not Ejected" ...</span></span>
<span><span class="co">#&gt;   ..$ ej_path      : chr [1:10150] "Ejection Path Not Applicable" "Ejection Path Not Applicable" "Ejection Path Not Applicable" "Ejection Path Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ extricat     : chr [1:10150] "Not Extricated or Not Applicable" "Not Extricated or Not Applicable" "Not Extricated or Not Applicable" "Not Extricated or Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ drinking     : chr [1:10150] "No (Alcohol Not Involved)" "Unknown (Police Reported)" "No (Alcohol Not Involved)" "No (Alcohol Not Involved)" ...</span></span>
<span><span class="co">#&gt;   ..$ alc_det      : chr [1:10150] "Not Reported" "Not Reported" "Not Reported" "Not Reported" ...</span></span>
<span><span class="co">#&gt;   ..$ alc_status   : chr [1:10150] "Test Given" "Test Given" "Test Given" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ atst_typ     : chr [1:10150] "Blood" "Blood" "Blood" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ alc_res      : chr [1:10150] "0.105 % BAC" "0.000 % BAC" "0.000 % BAC" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ drugs        : chr [1:10150] "No (drugs not involved)" "Unknown" "No (drugs not involved)" "No (drugs not involved)" ...</span></span>
<span><span class="co">#&gt;   ..$ drug_det     : chr [1:10150] "Not Reported" "Not Reported" "Not Reported" "Not Reported" ...</span></span>
<span><span class="co">#&gt;   ..$ dstatus      : chr [1:10150] "Test Given" "Test Given" "Test Given" "Test Not Given" ...</span></span>
<span><span class="co">#&gt;   ..$ hospital     : chr [1:10150] "EMS Unknown Mode" "EMS Unknown Mode" "Not Transported" "EMS Unknown Mode" ...</span></span>
<span><span class="co">#&gt;   ..$ doa          : chr [1:10150] "Not Applicable" "Not Applicable" "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ death_da     : chr [1:10150] "1" "2" "Not Applicable (Non-Fatal)" "5" ...</span></span>
<span><span class="co">#&gt;   ..$ death_mo     : chr [1:10150] "January" "January" "Not Applicable (Non-Fatal)" "January" ...</span></span>
<span><span class="co">#&gt;   ..$ death_yr     : chr [1:10150] "2015" "2015" "Not Applicable (Non-fatal)" "2015" ...</span></span>
<span><span class="co">#&gt;   ..$ death_hr     : num [1:10150] 17 19 88 20 15 88 88 8 1 88 ...</span></span>
<span><span class="co">#&gt;   ..$ death_mn     : num [1:10150] 51 39 88 15 37 88 88 24 45 88 ...</span></span>
<span><span class="co">#&gt;   ..$ death_tm     : chr [1:10150] "1751" "1939" "8888" "2015" ...</span></span>
<span><span class="co">#&gt;   ..$ lag_hrs      : num [1:10150] 2 0 999 78 0 999 999 0 0 999 ...</span></span>
<span><span class="co">#&gt;   ..$ lag_mins     : num [1:10150] 21 40 99 20 22 99 99 26 26 99 ...</span></span>
<span><span class="co">#&gt;   ..$ work_inj     : chr [1:10150] "No" "No" "Not Applicable (not a fatality)" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ hispanic     : chr [1:10150] "Non-Hispanic" "Non-Hispanic" "Not A Fatality (not Applicable)" "Non-Hispanic" ...</span></span>
<span><span class="co">#&gt;   ..$ location     : chr [1:10150] "Occupant of a Motor Vehicle" "At Intersection - Not In Crosswalk" "Occupant of a Motor Vehicle" "Occupant of a Motor Vehicle" ...</span></span>
<span><span class="co">#&gt;   ..$ numoccs      : chr [1:10150] "01" NA "01" "01" ...</span></span>
<span><span class="co">#&gt;   ..$ unittype     : chr [1:10150] "Motor Vehicle In-Transport (Inside or Outside the Trafficway)" NA "Motor Vehicle In-Transport (Inside or Outside the Trafficway)" "Motor Vehicle In-Transport (Inside or Outside the Trafficway)" ...</span></span>
<span><span class="co">#&gt;   ..$ hit_run      : chr [1:10150] "No" NA "No" "No" ...</span></span>
<span><span class="co">#&gt;   ..$ reg_stat     : chr [1:10150] "Virginia" NA "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ owner        : chr [1:10150] "Driver (in this crash) was  Registered Owner" NA "Driver (in this crash) was  Registered Owner" "Driver (in this crash) was  Registered Owner" ...</span></span>
<span><span class="co">#&gt;   ..$ make         : chr [1:10150] "Volvo" NA "Ford" "Chevrolet" ...</span></span>
<span><span class="co">#&gt;   ..$ model        : num [1:10150] 43 NA 401 16 38 39 39 481 404 404 ...</span></span>
<span><span class="co">#&gt;   ..$ mak_mod      : chr [1:10150] "Volvo 70 Series (For XC70 for 2014 on, use model code 402)" NA "Ford Bronco (thru 1977)/Bronco II/Explorer/Explorer Sport" "Chevrolet Cavalier" ...</span></span>
<span><span class="co">#&gt;   ..$ body_typ     : chr [1:10150] "Station Wagon (excluding van and truck based)" NA "Compact Utility (Utility Vehicle Categories \"Small\" and \"Midsize\")" "2-door sedan,hardtop,coupe" ...</span></span>
<span><span class="co">#&gt;   ..$ mod_year     : chr [1:10150] "2001" NA "2004" "1999" ...</span></span>
<span><span class="co">#&gt;   ..$ vin          : chr [1:10150] "YV1SZ58D1110" NA "1FMZU73W64ZA" "1G1JC1246X72" ...</span></span>
<span><span class="co">#&gt;   ..$ tow_veh      : chr [1:10150] "No Trailing Units" NA "No Trailing Units" "No Trailing Units" ...</span></span>
<span><span class="co">#&gt;   ..$ j_knife      : chr [1:10150] "Not an Articulated Vehicle" NA "Not an Articulated Vehicle" "Not an Articulated Vehicle" ...</span></span>
<span><span class="co">#&gt;   ..$ mcarr_i1     : chr [1:10150] "Not Applicable" NA "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ mcarr_i2     : chr [1:10150] "Not Applicable" NA "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ mcarr_id     : chr [1:10150] "Not Applicable" NA "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   ..$ v_config     : chr [1:10150] "Not Applicable" NA "Not Applicable" "Not Applicable" ...</span></span>
<span><span class="co">#&gt;   .. [list output truncated]</span></span>
<span><span class="co">#&gt;  $ multi_acc:'data.frame':   9939 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;   ..$ state  : chr [1:9939] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case: num [1:9939] 510001 510001 510002 510002 510003 ...</span></span>
<span><span class="co">#&gt;   ..$ name   : chr [1:9939] "weather" "weather" "weather" "weather" ...</span></span>
<span><span class="co">#&gt;   ..$ value  : chr [1:9939] "Clear" "Cloudy" "Clear" "Cloudy" ...</span></span>
<span><span class="co">#&gt;   ..$ year   : num [1:9939] 2015 2015 2015 2015 2015 ...</span></span>
<span><span class="co">#&gt;  $ multi_veh:'data.frame':   92933 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;   ..$ state  : chr [1:92933] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case: num [1:92933] 510001 510002 510003 510004 510004 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no : num [1:92933] 1 1 1 1 2 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ name   : chr [1:92933] "vehiclesf" "vehiclesf" "vehiclesf" "vehiclesf" ...</span></span>
<span><span class="co">#&gt;   ..$ value  : chr [1:92933] "None" "None" "None" "None" ...</span></span>
<span><span class="co">#&gt;   ..$ year   : num [1:92933] 2015 2015 2015 2015 2015 ...</span></span>
<span><span class="co">#&gt;  $ multi_per:'data.frame':   56963 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;   ..$ state  : chr [1:56963] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case: num [1:56963] 510001 510002 510002 510003 510004 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no : num [1:56963] 1 0 1 1 1 2 2 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ per_no : num [1:56963] 1 1 1 1 1 1 2 1 1 2 ...</span></span>
<span><span class="co">#&gt;   ..$ name   : chr [1:56963] "race" "race" "race" "race" ...</span></span>
<span><span class="co">#&gt;   ..$ value  : chr [1:56963] "White" "White" "Not a Fatality (not Applicable)" "White" ...</span></span>
<span><span class="co">#&gt;   ..$ year   : num [1:56963] 2015 2015 2015 2015 2015 ...</span></span>
<span><span class="co">#&gt;  $ events   :'data.frame':   16162 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;   ..$ state    : chr [1:16162] "Virginia" "Virginia" "Virginia" "Virginia" ...</span></span>
<span><span class="co">#&gt;   ..$ st_case  : num [1:16162] 510001 510001 510001 510001 510001 ...</span></span>
<span><span class="co">#&gt;   ..$ veh_no   : num [1:16162] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ veventnum: num [1:16162] 1 2 3 4 5 1 1 2 3 4 ...</span></span>
<span><span class="co">#&gt;   ..$ soe      : chr [1:16162] "Ran Off Roadway - Right" "Re-entering Roadway" "Ran Off Roadway - Left" "Other Post, Other Pole or Other Supports" ...</span></span>
<span><span class="co">#&gt;   ..$ aoi      : chr [1:16162] "Non-Harmful Event" "Non-Harmful Event" "Non-Harmful Event" "11 Clock Point" ...</span></span>
<span><span class="co">#&gt;   ..$ year     : num [1:16162] 2015 2015 2015 2015 2015 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "list" "FARS"</span></span></code></pre></div>
<p>You can review the list of variables to help guide your analysis with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">fars_varnames</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="counts">Counts<a class="anchor" aria-label="anchor" href="#counts"></a>
</h2>
<p>A first step in many transportation safety analyses involves counting the number of relevant crashes, fatalities, or people involved. <code><a href="reference/counts.html">counts()</a></code> lets users specify <em>what</em> to count, <em>where</em> to count them (rural/urban and/or in specified states), <em>who</em> to include, which <em>years</em> to include and an aggregation <em>interval</em> (annually or monthly), and factors <em>involved</em> in the crash. It returns a simple tibble that can be easily piped into <code>ggplot()</code> to quickly visualize counts.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>,</span>
<span>  interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Fatal Crashes in Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>,</span>
<span>  what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>  interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Fatalities in Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"rural"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Rural Fatalities in Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"rural"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>       involved <span class="op">=</span> <span class="st">"speeding"</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Speeding-Related Fatalities\nin Rural Virginia"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"></p>
<p>We can combine two <code><a href="reference/counts.html">counts()</a></code> results to make a comparison. Here we compare the number of speeding-related fatalities in rural and urban Virginia:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"rural"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>       involved <span class="op">=</span> <span class="st">"speeding"</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"Rural"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span><span class="va">myFARS</span>,</span>
<span>       what <span class="op">=</span> <span class="st">"fatalities"</span>,</span>
<span>       where <span class="op">=</span> <span class="st">"urban"</span>,</span>
<span>       interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>       involved <span class="op">=</span> <span class="st">"speeding"</span></span>
<span>       <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"Urban"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">n</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_label</span><span class="op">(</span>vjust<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">where</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, title <span class="op">=</span> <span class="st">"Speeding-Related Fatalities in Virginia"</span>, fill<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="mapping">Mapping<a class="anchor" aria-label="anchor" href="#mapping"></a>
</h2>
<p>We can take advantage of having access to the full data with maps. Here we map pedestrian and bicyclist fatalities in Virginia:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>, </span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>, </span>
<span>  involved <span class="op">=</span> <span class="st">"pedbike"</span>, </span>
<span>  filterOnly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addHeatmap</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Heatmap"</span>, radius<span class="op">=</span><span class="fl">10</span>, blur<span class="op">=</span><span class="fl">20</span>, minOpacity <span class="op">=</span> <span class="fl">.01</span>, max <span class="op">=</span> <span class="fl">.2</span>, cellSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span></span>
<span>    radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fillOpacity <span class="op">=</span> <span class="fl">0.7</span>, group <span class="op">=</span> <span class="st">"Crash Locations"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<p>Drug-related crashes:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>, </span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>, </span>
<span>  involved <span class="op">=</span> <span class="st">"drugs"</span>, </span>
<span>  filterOnly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addHeatmap</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Heatmap"</span>, radius<span class="op">=</span><span class="fl">10</span>, blur<span class="op">=</span><span class="fl">20</span>, minOpacity <span class="op">=</span> <span class="fl">.01</span>, max <span class="op">=</span> <span class="fl">.2</span>, cellSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span></span>
<span>    radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fillOpacity <span class="op">=</span> <span class="fl">0.7</span>, group <span class="op">=</span> <span class="st">"Crash Locations"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="100%"></p>
<p>Young drivers:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/counts.html">counts</a></span><span class="op">(</span></span>
<span>  <span class="va">myFARS</span>, </span>
<span>  what <span class="op">=</span> <span class="st">"crashes"</span>, </span>
<span>  involved <span class="op">=</span> <span class="st">"young driver"</span>, </span>
<span>  filterOnly <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addHeatmap</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"Heatmap"</span>, radius<span class="op">=</span><span class="fl">10</span>, blur<span class="op">=</span><span class="fl">20</span>, minOpacity <span class="op">=</span> <span class="fl">.01</span>, max <span class="op">=</span> <span class="fl">.2</span>, cellSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span></span>
<span>    radius <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fillOpacity <span class="op">=</span> <span class="fl">0.7</span>, group <span class="op">=</span> <span class="st">"Crash Locations"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Note: Young drivers are defined as those between the ages of 15 and 20.</span></span>
<span><span class="co">#&gt; Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span>
<span><span class="co">#&gt; Assuming "lon" and "lat" are longitude and latitude, respectively</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="modeling">Modeling<a class="anchor" aria-label="anchor" href="#modeling"></a>
</h2>
<p>Having access to the full dataset also allows us to develop statistical models. Here we fit a simple model of injury severity as a function of age and restraint use. It tells us that the average severity score among motor vehicle drivers and occupants wearing seatbelts (both the lap and shoulder belts) is 1.7 (close to, but less than “Suspected Minor Injury (B)”). Partial seatbelt use increases the predicted score to 2.1 (slightly above “Suspected Minor Injury (B)”). Not wearing any seatbelt, however increases the predicted score to 3.2 (slightly above “Suspected Serious Injury (A)”).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># table(myFARS$flat$inj_sev)</span></span>
<span><span class="co"># table(myFARS$flat$rest_use, useNA = "ifany")</span></span>
<span><span class="co"># table(myFARS$flat$per_typ, useNA = "ifany")</span></span>
<span></span>
<span><span class="va">myFARS</span><span class="op">$</span><span class="va">flat</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lap Belt Only Used"</span>,</span>
<span>                         <span class="st">"Shoulder Belt Only Used"</span>,</span>
<span>                         <span class="st">"None Used / Not Applicable"</span>,</span>
<span>                         <span class="st">"None Used/Not Applicable"</span>,</span>
<span>                         <span class="st">"Shoulder and Lap Belt Used"</span><span class="op">)</span>,</span>
<span>         <span class="va">per_typ</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Driver of a Motor Vehicle In-Transport"</span>,</span>
<span>                        <span class="st">"Passenger of a Motor Vehicle In-Transport"</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    rest_use <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lap Belt Only Used"</span>, <span class="st">"Shoulder Belt Only Used"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Partial"</span>,</span>
<span>      <span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"None Used / Not Applicable"</span>, <span class="st">"None Used/Not Applicable"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"None"</span>,</span>
<span>      <span class="va">rest_use</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Shoulder and Lap Belt Used"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Full"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Unknown"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="st">"Full"</span><span class="op">)</span>,</span>
<span>    kabco <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">inj_sev</span> <span class="op">==</span> <span class="st">"Fatal Injury (K)"</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Suspected Serious Injury (A)"</span>, </span>
<span>                     <span class="st">"Suspected Serious Injury(A)"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Suspected Minor Injury (B)"</span>, </span>
<span>                     <span class="st">"Suspected Minor Injury(B)"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op">==</span> <span class="st">"Possible Injury (C)"</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">inj_sev</span> <span class="op">==</span> <span class="st">"No Apparent Injury (O)"</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    age_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D+"</span>,<span class="st">""</span>, <span class="va">age</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">kabco</span> <span class="op">~</span> <span class="va">age_n</span> <span class="op">+</span> <span class="va">rest_use</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = kabco ~ age_n + rest_use, data = .)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -3.9365 -1.2017  0.2468  1.0656  2.2673 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                  Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)     1.6777025  0.0420932  39.857  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; age_n           0.0091662  0.0008356  10.969  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; rest_useNone    1.5072070  0.0368817  40.866  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; rest_usePartial 0.4320574  0.1496019   2.888  0.00389 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 1.412 on 7179 degrees of freedom</span></span>
<span><span class="co">#&gt;   (45 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.1926, Adjusted R-squared:  0.1922 </span></span>
<span><span class="co">#&gt; F-statistic: 570.8 on 3 and 7179 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/s87jackson/rfars/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/s87jackson/rfars/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>CC0</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rfars</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Steve Jackson <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/s87jackson/rfars" class="external-link"><img src="https://travis-ci.com/s87jackson/rfars.svg?branch=master" alt="Travis build status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
