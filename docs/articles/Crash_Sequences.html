<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rfars">
<title>Crash Sequences • rfars</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Crash Sequences">
<meta property="og:description" content="rfars">
<meta property="og:image" content="https://s87jackson.github.io/rfars/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rfars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Crash_sequences.html">Crash Sequences</a>
    <a class="dropdown-item" href="../articles/Rural_roads.html">Rural Roads</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/s87jackson/rfars/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Crash Sequences</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/s87jackson/rfars/blob/HEAD/vignettes/Crash_sequences.Rmd" class="external-link"><code>vignettes/Crash_sequences.Rmd</code></a></small>
      <div class="d-none name"><code>Crash_sequences.Rmd</code></div>
    </div>

    
    
<p>This vignette explores the <strong>vsoe</strong> (Vehicle Sequence of
Events) data to visualize crash sequence patterns.</p>
<p><strong>vsoe</strong> is one of three event-based data files, the
others being <strong>cevent</strong> and <strong>vevent</strong>.
According to the <a href="https://crashstats.nhtsa.dot.gov/Api/Public/ViewPublication/813436" class="external-link">CRSS
Analytical User’s Manual</a>, <strong>vevent</strong> “has the same data
elements as the <strong>cevent</strong> data file” plus “a data element
that records the sequential event number for each vehicle,” and the
<strong>vsoe</strong> file “has a subset of the data elements contained
in the <strong>Vevent</strong> data file (it is a simplified
<strong>vevent</strong> data file)” (p. 16). <code>rfars</code>
therefore omits <strong>cevent</strong> and <strong>vevent</strong>.</p>
<p>First we get one year of data, and filter to the southern region for
simplicity.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu">rfars</span><span class="fu">::</span><span class="fu"><a href="../reference/get_gescrss.html">get_gescrss</a></span><span class="op">(</span>years<span class="op">=</span><span class="fl">2021</span>, regions <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; cols(</span></span>
<span><span class="co">#&gt;   .default = col_character(),</span></span>
<span><span class="co">#&gt;   year = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   psu = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   psustrat = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   casenum = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   weight = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   id = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   veh_no = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   per_no = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   minute = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   mod_year = <span style="color: #BBBB00;">col_logical()</span>,</span></span>
<span><span class="co">#&gt;   model = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   peds = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   permvit = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   pernotmvit = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   psu_var = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   pvh_invl = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   str_veh = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   ve_forms = <span style="color: #00BB00;">col_double()</span>,</span></span>
<span><span class="co">#&gt;   ve_total = <span style="color: #00BB00;">col_double()</span></span></span>
<span><span class="co">#&gt; )</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` for the full column specifications.</span></span>
<span></span>
<span><span class="va">my_events</span> <span class="op">&lt;-</span> <span class="va">mydata</span><span class="op">$</span><span class="va">events</span></span></code></pre></div>
<p>The <strong>Vsoe</strong> data is stored in the <code>events</code>
tibble of the object returned by <code><a href="../reference/get_gescrss.html">get_gescrss()</a></code>. Here we see
the top 10 individual events:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_events</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">soe</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">#&gt;    soe                            n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Motor Vehicle In-Transport <span style="text-decoration: underline;">82</span>664</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Ran Off Roadway - Right     <span style="text-decoration: underline;">8</span>191</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Parked Motor Vehicle        <span style="text-decoration: underline;">5</span>914</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Ran Off Roadway - Left      <span style="text-decoration: underline;">5</span>529</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Rollover/Overturn           <span style="text-decoration: underline;">3</span>460</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Pedestrian                  <span style="text-decoration: underline;">2</span>917</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Cross Centerline            <span style="text-decoration: underline;">2</span>638</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Tree (Standing Only)        <span style="text-decoration: underline;">2</span>076</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Live Animal                 <span style="text-decoration: underline;">1</span>869</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Pedalcyclist                <span style="text-decoration: underline;">1</span>822</span></span></code></pre></div>
<p>We can also see the top 10 most common sequences:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_events</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">aoi</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"veventnum"</span>, values_from <span class="op">=</span> <span class="st">"soe"</span>, values_fill <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>              names_prefix <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"event"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by_all.html" class="external-link">group_by_all</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">event1</span>, <span class="va">event2</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">#&gt;    event1                     event2                         n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Motor Vehicle In-Transport x                          <span style="text-decoration: underline;">67</span>806</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Motor Vehicle In-Transport Motor Vehicle In-Transport  <span style="text-decoration: underline;">4</span>106</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Parked Motor Vehicle       x                           <span style="text-decoration: underline;">2</span>996</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Pedestrian                 x                           <span style="text-decoration: underline;">2</span>291</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Live Animal                x                           <span style="text-decoration: underline;">1</span>772</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Pedalcyclist               x                           <span style="text-decoration: underline;">1</span>703</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Ran Off Roadway - Right    Parked Motor Vehicle         848</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Cross Centerline           Motor Vehicle In-Transport   752</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Ran Off Roadway - Right    Utility Pole/Light Support   418</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Rollover/Overturn          x                            404</span></span></code></pre></div>
<p>Below we consider all state transitions - the transition from one
event to the next in the sequence. For example, the sequence A-B-C-D has
three transitions: A to B, B to C, and C to D. The graph below shows a
subset of the more common transitions in the crash sequences. It is
interpreted as follows: the event listed on the x-axis (top) was
followed by the event listed on the y-axis. The percentage shown at the
graphical intersection represents the percentage of transitions from one
event (x) to another event (y). For example, ‘Fence’ was followed by
‘Tree (Standing Only)’ in 21% of sequences. Note that we have added a
state labelled ‘Pre-Crash’ to help account for sequences with just one
event. Another notable takeaway is the large number of events that
precede ’Rollover/Overturn.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_events</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">casenum</span>, <span class="va">veh_no</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>event_to <span class="op">=</span> <span class="va">soe</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>event_from <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">event_to</span>, fill <span class="op">=</span> <span class="st">"Pre-Crash"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">event_from</span>, <span class="va">event_to</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">event_from</span>, <span class="va">event_to</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">event_from</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_pct <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="va">n_from</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_pct</span><span class="op">&gt;</span><span class="fl">.2</span>, <span class="va">n</span><span class="op">&gt;</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    event_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">event_from</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">event_from</span>, <span class="fl">1</span>, <span class="fl">30</span><span class="op">)</span>, <span class="st">"..."</span><span class="op">)</span>, <span class="va">event_from</span><span class="op">)</span>,</span>
<span>    <span class="co">#event_to   = paste0(stringr::str_sub(event_to, 1, 30), "..."),</span></span>
<span>    event_to <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html" class="external-link">str_wrap</a></span><span class="op">(</span><span class="va">event_to</span>, <span class="fl">40</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">event_from</span> <span class="op">!=</span> <span class="va">event_to</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">event_from</span>, y<span class="op">=</span><span class="va">event_to</span>, fill<span class="op">=</span><span class="va">n_pct</span>, label<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">n_pct</span>, accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      axis.text.x.top <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span>, hjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>      axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="co">#axis.text.x.bottom = element_text(angle=270, hjust = 0, vjust=.5),</span></span>
<span>      <span class="co">#legend.position = "none"</span></span>
<span>      <span class="op">)</span></span>
<span><span class="co">#&gt; Adding missing grouping variables: `year`, `casenum`, `veh_no`</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'event_from'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre></div>
<p><img src="Crash_Sequences_files/figure-html/unnamed-chunk-5-1.png" width="960"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Steve Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
